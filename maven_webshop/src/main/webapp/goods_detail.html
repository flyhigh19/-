<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>商品详细信息</title>
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/shop/webshop_goods-detail.css">
    <link rel="stylesheet" type="text/css" href="css/shop/shop_num.css">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/shop/shop_index.css">

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.3.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
    <script type="text/javascript" src="js/web_shop/webshop_index.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!--引入头部-->
<div id="header"></div>
    <!-- 详情 start -->   
    <div class="wrap">
        <div class="bread_box">
            <a href="/index.html">首页</a>
            <span> &gt;</span>
            <a id="typeName"></a>
            <span> &gt;</span>
            <a href="javascript:void(0)" id="goodsName"></a>
        </div>
        <div class="prosum_box">
            <dl class="prosum_left">
                <dt>
                    <img alt="" class="big_img" src="">
                </dt>
                <dd id="dd">
                    <a class="up_img up_img_disable">
                        <img src="images/detail/left.png">
                    </a>
                    <a title="" class="little_img cur_img" data-bigpic="">
                        <img src="">
                    </a>
                    <a title="" class="little_img" data-bigpic="">
                        <img src="">
                    </a>
                    <a title="" class="little_img" data-bigpic="">
                        <img src="">
                    </a>
                    <a title="" class="little_img" data-bigpic="">
                        <img src="">
                    </a>
                    <a title="" class="little_img" data-bigpic="">
                        <img src="">
                    </a>
                    <a title="" class="little_img" data-bigpic="" style="display: none">
                        <img src="">
                    </a>
                    <a class="down_img down_img_disable" style="margin-bottom: 0;">
                        <img src="images/detail/right.png">
                    </a>
                </dd>
                <span>
                    <a class="btn" id="favorite"><i class="glyphicon glyphicon glyphicon-star-empty"></i>点击收藏</a>
                    <a class="btn" id="unFavorite"><i class="glyphicon glyphicon-heart-empty"></i>取消收藏</a>
                </span>
                <span id="favoriteCount" class="favoriteCount"></span>
            </dl>
            <div class="prosum_right">
                <p class="pros_title" id="description"></p>
                <p class="hot" id="subTitle"></p>
                <div class="pros_eval">
                    <span class="star_box">
                        <span class="star" style="width:100%"></span>
                    </span>
                    <a href="javascript:void(0)" id="evalCount" dd_name="评论数">0</a>条评论
                </div>
                <div class="pros_other">
                    <p >价格&nbsp;&nbsp;&nbsp;&nbsp;￥<span id="price">3699.00</span></p>
                    <p id="discountPrice_lump">促销价&nbsp;&nbsp;&nbsp;<span id="discountPrice" class="sale_price">￥3299.00</span></p>
                    <p id="discountDesc_lump">本店活动&nbsp;&nbsp;&nbsp;&nbsp;<span id="discountDesc" class="sale_desc">满3000减1300</span></p>
                </div>
                <!--<div class="pros_address">
                    <p>配送地址&nbsp;&nbsp;&nbsp;&nbsp;
                        <span>
                            湖南&nbsp;&nbsp;至
                            <span class="text" id="geo-name" dd_name="配送至">湖南长沙市岳麓区</span>
                            包邮
                        </span>
                    </p>
                </div>-->
                <div class="pros_fuwu">
                    <p>服&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;务&nbsp;&nbsp;&nbsp;
                        <span id="factory">

                        </span>
                    </p>
                </div>
                <div class="pros_shuliang">
                    <ul class="btn-numbox">
                        <li><span class="number">数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;量</span></li>
                        <li>
                            <ul class="count">
                                <li><span id="num-jian" class="num-jian">-</span></li>
                                <li><input type="text" class="input-num" id="input-num" value="1" /></li>
                                <li><span id="num-jia" class="num-jia">+</span></li>
                            </ul>
                        </li>
                        <li><span class="kucun" id="kucun"></span></li>
                    </ul>
                </div>
                <div class="btn_sure">
                    <a href="#" class="now_bug">立即购买</a>
                    <a href="javascript:void(0)" class="insert_cart" id="insert_cart">加入购物车</a>
                </div>
            </div>
        </div>
    </div>
    <!-- 详情 end -->

    <!--引入头部-->
    <div id="footer"></div>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.3.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
    <script src="js/getParameter.js"></script>
    <script>
    $(document).ready(function() {
        //自动播放
        goImg();
    });
    function goImg(){
        //焦点图效果
        //点击图片切换图片
        $('.little_img').on('mousemove', function() {
            $('.little_img').removeClass('cur_img');
            var big_pic = $(this).data('bigpic');
            $('.big_img').attr('src', big_pic);
            $(this).addClass('cur_img');
        });
        //上下切换
        var picindex = 0;
        var nextindex = 5;
        $('.down_img').on('click',function(){
            var num = $('.little_img').length;
            if((nextindex + 1) <= num){
                $('.little_img:eq('+picindex+')').hide();
                $('.little_img:eq('+nextindex+')').show();
                picindex = picindex + 1;
                nextindex = nextindex + 1;
            }
        });
        $('.up_img').on('click',function(){
            var num = $('.little_img').length;
            if(picindex > 0){
                $('.little_img:eq('+(nextindex-1)+')').hide();
                $('.little_img:eq('+(picindex-1)+')').show();
                picindex = picindex - 1;
                nextindex = nextindex - 1;
            }
        });
    }
    /*数量加减的js代码*/
    var num_jia = document.getElementById("num-jia");
    var num_jian = document.getElementById("num-jian");
    var input_num = document.getElementById("input-num");

    num_jia.onclick = function() {
        input_num.value = parseInt(input_num.value) + 1;
    }

    num_jian.onclick = function() {
        if(input_num.value <= 0) {
            input_num.value = 0;
        } else {
            input_num.value = parseInt(input_num.value) - 1;
        }
    }
    //给二级菜单注册点击事件
    $("#typeName").click(function () {
        //获取搜索框中输入的值
        location.href="goods_list.html?goodsID="+goodsID;
    })
    /*收藏功能*/
    var islogin=false;
    $(function () {
        /*购物车功能实现*/
        $("#insert_cart").click(function () {
            var goodsNum =$("#input-num").val();
            $.post("cart/addShopCart.do",{goodsID:goodsID,item:item,goodsNum:goodsNum},function (data) {
                if(data.flag){
                    //添加商品至购物车成功
                    var flag=window.confirm("商品已成功添加至购物车，去购物车结算？？");
                    if(flag){
                        location.href="shop_cart.html";
                    }
                }else{
                    alert("商品添加失败，请重试！！！")
                }
            })
        })
        /*判断用户是否已经登录的状态*/
        $.get("user/FindLoginUser.do",{},function (LoginUser) {
            if(LoginUser){
                islogin=true;
                //判断用户是否已经收藏了此产品
                $.get("favorite/isFavorite.do",{goodsID:goodsID,item:item},function (data) {
                    if(data.flag){
                        $("#favorite").hide();
                        $("#unFavorite").show();
                    }else{
                        $("#favorite").show();
                        $("#unFavorite").hide();
                    }
                })
            }else{
                $("#favorite").show();
                $("#unFavorite").hide();
            }
        });
        //处理点击收藏功能
        $("#favorite").click(function () {
            //去判断用户是否已经登录
            if(islogin){
                //已经登录
                $.post("favorite/addFavorite.do",{goodsID:goodsID,item:item},function (data) {
                    if(data.flag){
                        //收藏成功
                        alert("收藏成功！！")
                        $("#favorite").hide();
                        $("#unFavorite").show();
                        //重新获取收藏次数
                        findFavoriteCount();
                    }else{
                        //收藏失败
                        alert("收藏失败，请重试！！")
                        $("#favorite").show();
                        $("#unFavorite").hide();
                    }
                })
            }else{
                //没有登录
                var flag=window.confirm("用户没有登录，请先登录！！");
                if(flag){
                    location.href="login.html";
                }
            }
        })
        //处理取消收藏功能
        $("#unFavorite").click(function () {
            //去判断用户是否已经登录
            if(islogin){
                //已经登录
                $.post("favorite/removeFavorite.do",{goodsID:goodsID,item:item},function (data) {
                    if(data.flag){
                        //收藏成功
                        alert("取消收藏成功！！")
                        $("#favorite").show();
                        $("#unFavorite").hide();
                        //重新获取收藏次数
                        findFavoriteCount();
                    }else{
                        //收藏失败
                        alert("取消收藏失败，请重试！！")
                        $("#favorite").hide();
                        $("#unFavorite").show();
                    }
                })
            }else{
                //没有登录
                var flag=window.confirm("用户没有登录，请先登录！！");
                if(flag){
                    location.href="login.html";
                }
            }
        })
        //发送请求获取产品的收藏次数
        function findFavoriteCount(){
            $.get("favorite/favoriteCount.do",{goodsID:goodsID,item:item},function (result) {
                $("#favoriteCount").html("已收藏"+result.count+"次");
            })
        }
        findFavoriteCount();
    })
    /*请求商品详细信息*/
    var goodsID=getParameter("goodsID");
    var item=getParameter("item");
    $.get("/goods/findGoodsDetail.do",{goodsID:goodsID,item:item},function (data) {
        $("#typeName").html(data.typeName);
        $("#goodsName").html(data.goodsName);
        $("#description").html(data.description);
        $("#price").html(data.price.toFixed(2));
        $("#factory").html("由<"+data.factory+">发货，并提供售后服务。")
        /*是否包含商品的详细信息，如果没有直接对样式进行更改*/
        if(data.goodsDetail!=null){
            /*如果副标题存在则添加，如果没有则不添加*/
            if(data.goodsDetail.subTitle!=null){
                $("#subTitle").html(data.goodsDetail.subTitle);
            }else{
                $("#subTitle").html(" ");
            }
            /*如果存在评论次数则添加，并修改样式，如果没有则设置评论数为0*/
            if(data.goodsDetail.evalCount!=null){
                if(data.goodsDetail.evalCount>=1&&data.goodsDetail.evalCount<=20){
                    $(".pros_eval .star_box").css('width','12px');
                }else if(data.goodsDetail.evalCount>20&&data.goodsDetail.evalCount<=40){
                    $(".pros_eval .star_box").css('width','26px')
                }else if(data.goodsDetail.evalCount>40&&data.goodsDetail.evalCount<=80){
                    $(".pros_eval .star_box").css('width','40px')
                }else if(data.goodsDetail.evalCount>80&&data.goodsDetail.evalCount<=120){
                    $(".pros_eval .star_box").css('width','55px')
                }else{
                    $(".pros_eval .star_box").css('width','68px')
                }
                $("#evalCount").html(data.goodsDetail.evalCount);
            }else {
                $("#evalCount").html("0");
            }
            /*如果存在折扣价格，则添加，否则就只显示当前价格*/
            if(data.goodsDetail.discountPrice!=null&&data.goodsDetail.discountPrice!="0.00"){
                $("#price").css('text-decoration','line-through'); /*添加价格上面的样式*/
                $("#discountPrice").html("¥"+data.goodsDetail.discountPrice.toFixed(2));
            }else{
                $("#discountPrice_lump").remove();
            }
            /*如果存在折扣价格描述，则添加，否则就删除折扣价格描述*/
            if(data.goodsDetail.discountDesc!=null&&data.goodsDetail.discountDesc.length>1){
                $("#discountDesc").html(data.goodsDetail.discountDesc);
            }else{
                $("#discountDesc_lump").remove();
            }
            /*商品库存*/
            if(data.goodsDetail.repertory!=null){
                $("#kucun").html("库存"+data.goodsDetail.repertory+"件");
            }else{
                $("#kucun").html("库存不足")
            }
        }else{
            $("#subTitle").html(" ");
            $("#evalCount").html("0");
            $("#discountPrice_lump").remove();
            $("#discountDesc_lump").remove();
            $("#kucun").html("库存不足")
        }
        /*从数据库中动态添加图片,如果为空不添加*/
        if(data.goodsImgList.length>0){
            var dt_content='<img alt="" class="big_img" src="'+data.goodsImgList[0].bigPic+'">\n';
            $("dt").html(dt_content);

            $("dd").html("");
            $("dd").append('<a class="up_img up_img_disable">\n' +
                '                        <img src="images/detail/left.png">\n' +
                '                    </a>');
            for(var i=0;i<data.goodsImgList.length;i++){
                var goodsImage=data.goodsImgList[i];
                var dd_item;
                if(i<5){
                    dd_item ='<a title="" class="little_img" data-bigpic="'+goodsImage.bigPic+'">\n' +
                        '                        <img src="'+goodsImage.smallPic+'">\n' +
                        '                    </a>'
                }else{
                    dd_item ='<a title="" class="little_img" data-bigpic="'+goodsImage.bigPic+'" style="display:none;">\n' +
                        '                        <img src="'+goodsImage.smallPic+'">\n' +
                        '                    </a>'
                }
                $("dd").append(dd_item);
            }
            $("dd").append('<a class="down_img down_img_disable" style="margin-bottom: 0;">\n' +
                '                        <img src="images/detail/right.png">\n' +
                '                    </a>');
            goImg();
        }else{
            $(".big_img").css('width','400px');
            $(".big_img").css('height','400px');
            $(".big_img").attr('alt','暂无商品图片,敬请期待...');
        }
    })
    /*//用户是否已经登录的状态
    var islogin=false;
    $(function () {
        var rid=getParameter("rid");
        $.get("user/FindLoginUser.do",{},function (LoginUser) {
            if(LoginUser){
                islogin=true;
                //判断用户是否已经收藏了此产品
                $.get("/favorite/isFavorite.do",{rid:rid},function (data) {
                    if(data.flag){
                        $("#favorite").hide();
                        $("#unFavorite").show();
                    }else{
                        $("#favorite").show();
                        $("#unFavorite").hide();
                    }
                })
            }
        });
        //处理点击收藏功能
        $("#favorite").click(function () {
            //去判断用户是否已经登录
            if(islogin){
                //已经登录
                $.post("/favorite/addFavorite.do",{rid:rid},function (data) {
                    if(data.flag){
                        //收藏成功
                        alert("收藏成功！！")
                        $("#favorite").hide();
                        $("#unFavorite").show();
                        //重新获取收藏次数
                        findFavoriteCount();
                    }else{
                        //收藏失败
                        alert("收藏失败，请重试！！")
                        $("#favorite").show();
                        $("#unFavorite").hide();
                    }
                })
            }else{
                //没有登录
                var flag=window.confirm("用户没有登录，请先登录！！");
                if(flag){
                    location.href="login.html";
                }
            }
        })
        //处理取消收藏功能
        $("#unFavorite").click(function () {
            //去判断用户是否已经登录
            if(islogin){
                //已经登录
                $.post("/favorite/removeFavorite.do",{rid:rid},function (data) {
                    if(data.flag){
                        //收藏成功
                        alert("取消收藏成功！！")
                        $("#favorite").show();
                        $("#unFavorite").hide();
                        //重新获取收藏次数
                        findFavoriteCount();
                    }else{
                        //收藏失败
                        alert("取消收藏失败，请重试！！")
                        $("#favorite").hide();
                        $("#unFavorite").show();
                    }
                })
            }else{
                //没有登录
                var flag=window.confirm("用户没有登录，请先登录！！");
                if(flag){
                    location.href="login.html";
                }
            }
        })

        function findFavoriteCount(){
            //发送请求获取产品的收藏次数
            $.get("/favorite/favoriteCount.do",{rid:rid},function (count) {
                $("#favoriteCount").html("已收藏"+count+"次");
            })
        }
        findFavoriteCount();
    })*/
    </script>
</body>
</html>