<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>我的订单生成</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/shop/orderconfirm.css">
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="js/jquery-3.3.1.js"></script>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="js/bootstrap.min.js"></script>
    <script>
        $(function () {
            $.post("order/findGoodsOrderList.do",{},function (data) {
                if(data.flag){
                    $.post("user/FindLoginUser.do",{},function (data) {
                        if(data==null||data.receiveMsg==null||data.receiveMsg.length==0){
                            /*如果用户的收货地址信息为空，弹出模态框，让用户输入用户收货人姓名和收货地址*/
                            $("#addProduct").modal("show")
                            $("#add").click(function () {
                                $.post("order/addReceiveMsg.do",$("#addProduct_form").serialize(),function (data) {
                                    if(data.flag){
                                        location.href="/orderconfirm.html";
                                    }else{
                                        alert("添加收货地址失败")
                                    }
                                })
                            })
                        }else{
                            $("#receivemsg").html("");
                            for(var i=0;i<data.receiveMsg.length;i++){
                                if(data.receiveMsg[i].isDefault==1){
                                    var receiveBlock='<li class="addr active"  address_index="0" address_id="305735500" address_status="2">\n' +
                                        '                        <h1 id="memberName'+i+'">'+data.receiveMsg[i].receiveName+'\n' +
                                        '                            <span id="memberPhone'+i+'">'+data.receiveMsg[i].receivePhone.substr(0, 3) + '****' + data.receiveMsg[i].receivePhone.substring(7, 11)+'</span>\n' +
                                        '                        </h1>\n' +
                                        '                        <p id="memberAddress1'+i+'">'+data.receiveMsg[i].receiveAddress+'</p>\n' +
                                        '                        <p id="memberAddress2'+i+'" style="width: 200px;text-align: left">****'+data.receiveMsg[i].receiveDetailAddress.substring(4,data.receiveMsg[i].receiveDetailAddress.length)+'</p>\n' +
                                        '                        <span id="oper_305735500">\n' +
                                        '                            <a href="javascript:void(0)" name="oper" id="edit'+i+'">编辑</a>\n' +
                                        '                            <a href="javascript:void(0)" name="oper" id="delete'+i+'">删除 </a>\n' +
                                        '                            <a href="javascript:void(0)" class="addmoren"><em></em>默认地址</a>\n' +
                                        '                        </span>\n' +
                                        '                    </li>'
                                    $("#receivemsg").append(receiveBlock)
                                }else{
                                    var receiveBlock='<li class="addr active"  address_index="0" address_id="305735500" address_status="2">\n' +
                                        '                        <h1 id="memberName'+i+'">'+data.receiveMsg[i].receiveName+'\n' +
                                        '                            <span id="memberPhone'+i+'">'+data.receiveMsg[i].receivePhone.substr(0, 3) + '****' + data.receiveMsg[i].receivePhone.substring(7, 11)+'</span>\n' +
                                        '                        </h1>\n' +
                                        '                        <p id="memberAddress1'+i+'">'+data.receiveMsg[i].receiveAddress+'</p>\n' +
                                        '                        <p id="memberAddress2'+i+'" style="width: 200px;text-align: left">****'+data.receiveMsg[i].receiveDetailAddress.substring(4,data.receiveMsg[i].receiveDetailAddress.length)+'</p>\n' +
                                        '                        <span id="oper_305735500">\n' +
                                        '                            <a href="javascript:void(0)" name="oper" id="edit'+i+'">编辑</a>\n' +
                                        '                            <a href="javascript:void(0)" name="oper" id="delete'+i+'">删除 </a>\n' +
                                        '                            <a href="javascript:void(0)" class="us" name="oper" id="default'+i+'">设为默认地址</a>\n' +
                                        '                        </span>\n' +
                                        '                    </li>'
                                    $("#receivemsg").append(receiveBlock)
                                }
                            }
                            $('#addProduct').on('show.bs.modal', function (event) {
                                var button = $(event.relatedTarget) // Button that triggered the modal
                                var recipient = button.data('whatever') // Extract info from data-* attributes
                                // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
                                // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
                                var modal = $(this)
                                modal.find('.modal-title').text('新增收货地址')
                            })
                            $("#add").click(function () {
                                $.post("order/addReceiveMsg.do",$("#addProduct_form").serialize(),function (data) {
                                    if(data.flag){
                                        location.href="/orderconfirm.html";
                                    }else{
                                        alert("添加收货地址失败")
                                    }
                                })
                            })
                        }
                        /*去支付*/
                        $("#order_submit").click(function () {
                            if(data.receiveMsg.length==0){
                                alert("请添加收货地址之后再确认支付！！")
                                $("#addProduct").modal("show")
                            }else{
                                /*如果用户没有添加收货地址，则不允许支付和添加订单信息至数据库*/
                                $.post("order/confirmOrder.do",{},function (data) {
                                    if(data.flag){
                                        alert("订单已经完成，请前往支付界面付款！！")
                                        /*重定向至支付界面*/
                                        location.href="payment.html";
                                    }else{
                                        alert("生成订单失败，请刷新后重试！！")
                                        location.href="/shop_cart.html";
                                    }
                                })
                            }
                        })
                        for(var i=0;i<data.receiveMsg.length;i++){
                            var id=0;
                            /*修改收货地址*/
                            $("#edit"+i).click(function () {
                                $("#updateProduct").modal("show")
                                id=$(this).attr("id").substring(4,5);
                                //console.log(data.receiveMsg[id].receiveID);
                            })
                            var flag=false;
                            $("#update").click(function () {
                                if(flag){

                                }else{
                                    var dataForm=$("#updateaddProduct_form").serialize();
                                    dataForm+="&receiveID="+data.receiveMsg[id].receiveID+"&member_ReceiveAddress="+data.receiveMsg[id].member_ReceiveAddress+"&isDefault="+data.receiveMsg[id].isDefault;
                                    console.log(dataForm)
                                    $.post("order/updateReceiveMsg.do",dataForm,function (data) {
                                        if(data.flag){
                                            location.href="/orderconfirm.html";
                                        }else{
                                            alert("修改收货地址失败")
                                        }
                                    })
                                    flag=true;
                                }
                            })
                            /*删除收货地址*/
                            var receiveID=null;
                            $("#delete"+i).click(function () {
                                var deleteid=$(this).attr("id").substring(6,7);
                                /*console.log(data.receiveMsg[deleteid].receiveID);*/
                                $.post("order/deleteReceiveMsg.do",{receiveID:data.receiveMsg[deleteid].receiveID},function (data) {
                                    if(data.flag){
                                        location.href="/orderconfirm.html";
                                    }else{
                                        alert("删除收货地址失败")
                                    }
                                })
                            })
                            /*更换默认地址*/
                            $("#default"+i).click(function () {
                                var defaultid=$(this).attr("id").substring(7,8);
                                console.log(data.receiveMsg[defaultid].receiveID);
                                $.post("order/setDefaultAddress.do",{receiveID:data.receiveMsg[defaultid].receiveID},function (data) {
                                    if(data.flag){
                                        location.href="/orderconfirm.html";
                                    }else{
                                        alert("设置默认地址收货地址失败")
                                    }
                                })
                            })
                            if(data.receiveMsg[i].isDefault==1){
                                $("#address_summary").html("中国&nbsp;&nbsp;"+data.receiveMsg[i].receiveAddress+"&nbsp;&nbsp;"+"****"+data.receiveMsg[i].receiveDetailAddress.substring(4,data.receiveMsg[i].receiveDetailAddress.length));
                                $("#name_phone_summary").html(data.receiveMsg[i].receiveName+"&nbsp;&nbsp;"+data.receiveMsg[i].receivePhone.substr(0, 3) + '****' + data.receiveMsg[i].receivePhone.substring(7, 11))
                            }
                        }
                    })


                    $("#shipment").html("");
                    var orderGoodsName='<h1 class="title">\n' +
                        '                <a href="/shop_cart.html" class="fr modify">返回购物车</a>\n' +
                        '                商品清单\n' +
                        '            </h1>'
                    $("#shipment").append(orderGoodsName)
                    for (var i = 0; i < data.data.items.length; i++) {
                        var goodsMsg = data.data.items[i];
                        console.log()
                        if(goodsMsg.goods.goodsDetail!=null){
                            var orderGoods='<div class="shipping" id="shipping'+i+'">\n' +
                                '                <div class="title">'+goodsMsg.goods.factory+'</div>\n' +
                                '                <div class="ship_box">\n' +
                                '                    <div class="shangpin">\n' +
                                '                        <div class="shangpin_left">\n' +
                                '                            <div class="left" id="delivery_8525_0"><a href="#shipmentAnchor_8525_0" name="shipmentAnchor_8525_0" id="shipmentAnchor_8525_0"></a>\n' +
                                '                                <p class="method_tip red" style="color:black;text-align: left">\n' +
                                '                                    <span class="icon_tip_s" style="display:none;"></span>请选择配送方式\n' +
                                '                                </p>\n' +
                                '                                <div id="divDeliveryMethod_8525_0">\n' +
                                '                                    <ul class="method">\n' +
                                '                                        <li>\n' +
                                '                                            <a id="methed_id_1" class="current" href="javascript:void(0);">普通快递</a>\n' +
                                '                                        </li>\n' +
                                '                                    </ul>\n' +
                                '                                </div>\n' +
                                '                            </div>\n' +
                                '                        </div>\n' +
                                '                        <div class="shangpin_right">\n' +
                                '                            <div class="subpackage_title">\n' +
                                '                                以下商品 单独配送\n' +
                                '                                <span class="charge">运费:'+goodsMsg.yufei.toFixed(2)+'</span>\n' +
                                '                            </div>\n' +
                                '                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
                                '                                <tbody>\n' +
                                '                                <tr>\n' +
                                '                                    <th scope="col" class="th_img">&nbsp;</th>\n' +
                                '                                    <th scope="col" class="th_name">商品名称</th>\n' +
                                '                                    <th scope="col">单价</th>\n' +
                                '                                    <th scope="col">数量</th>\n' +
                                '                                    <th scope="col">总价</th>\n' +
                                '                                </tr>\n' +
                                '                                <!-- 普通商品 -->\n' +
                                '                                </tbody>\n' +
                                '                            </table>\n' +
                                '                            <div class="promo_title">商品已为您打包好，欢迎下次继续光顾！！</div>\n' +
                                '                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
                                '                                <tbody>\n' +
                                '                                <tr id="1517542454_NOTGIFT" ddt-data-key="productid" ddt-data="1517542454">\n' +
                                '                                    <td class="img">\n' +
                                '                                        <a href="/goods_detail.html?goodsID='+goodsMsg.goods.goodsID+'&&item='+goodsMsg.goods.item+'"><img src="'+goodsMsg.goods.imgsrc+'" height="70" width="70"></a>\n' +
                                '                                    </td>\n' +
                                '                                    <td class="name">\n' +
                                '                                        <a href="/goods_detail.html?goodsID='+goodsMsg.goods.goodsID+'&&item='+goodsMsg.goods.item+'"  target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">'+goodsMsg.goods.description+'</a>\n' +
                                '                                        <p class="seven">\n' +
                                '                                            <span class="icon_7"></span>支持7天无理由退换货\n' +
                                '                                        </p>\n' +
                                '                                    </td>\n' +
                                '                                    <td>'+goodsMsg.goods.price.toFixed(2)+'</td>\n' +
                                '                                    <td>'+goodsMsg.goodsNum+'</td>\n' +
                                '                                    <td>'+(goodsMsg.goodsNum*goodsMsg.goods.price).toFixed(2)+'</td>\n' +
                                '                                </tr>\n' +
                                '                                </tbody>\n' +
                                '                            </table>\n' +
                                '                            <div class="promo_total"><em>促销优惠：'+((goodsMsg.goods.price-goodsMsg.goods.goodsDetail.discountPrice)*goodsMsg.goodsNum).toFixed(2)+'</em><em>小计：'+(goodsMsg.goodsNum*goodsMsg.goods.price-(goodsMsg.goods.price-goodsMsg.goods.goodsDetail.discountPrice)*goodsMsg.goodsNum).toFixed(2)+'</em></div>\n' +
                                '                        </div>\n' +
                                '                    </div>\n' +
                                '                    <div class="sub">\n' +
                                '                        <div class="sub_left">\n' +
                                '                            <p>给商家留言<textarea id="text_shop_message_8525_0" name="" cols="" rows="2" maxlength="70"></textarea>\n' +
                                '                                <span class="txt_n" id="shop_message_length_8525_0">0/70</span>\n' +
                                '                            </p>\n' +
                                '                        </div>\n' +
                                '                        <div class="sub_right">\n' +
                                '                            <p>\n' +
                                '                                <span class="red" id="goodsNum'+i+'">'+goodsMsg.goodsNum+'</span>个包裹\n' +
                                '                                <span class="tab" id="goodsPrice'+i+'">商品金额：'+(goodsMsg.goodsNum*goodsMsg.goods.price).toFixed(2)+'</span>\n' +
                                '                                <span class="tab" id="yufei'+i+'">运费：'+goodsMsg.yufei.toFixed(2)+'</span>\n' +
                                '                                <span class="tab">促销优惠：\n' +
                                '                                    <span class="price" id="cuxiao'+i+'">-'+((goodsMsg.goods.price-goodsMsg.goods.goodsDetail.discountPrice)*goodsMsg.goodsNum).toFixed(2)+'</span>\n' +
                                '\t\t\t\t                </span>\n' +
                                '                            </p>\n' +
                                '                            <p>\n' +
                                '                                <span class="tab">店铺合计：</span>\n' +
                                '                                <span class="price red">'+((goodsMsg.goodsNum*goodsMsg.goods.price-(goodsMsg.goods.price-goodsMsg.goods.goodsDetail.discountPrice)*goodsMsg.goodsNum)+goodsMsg.yufei).toFixed(2)+'</span>\n' +
                                '                            </p>\n' +
                                '                        </div>\n' +
                                '                    </div>\n' +
                                '                </div>\n' +
                                '            </div>'
                            $("#shipment").append(orderGoods)
                        }else{
                            var orderGoods='<div class="shipping" id="shipping'+i+'">\n' +
                                '                <div class="title">'+goodsMsg.goods.factory+'</div>\n' +
                                '                <div class="ship_box">\n' +
                                '                    <div class="shangpin">\n' +
                                '                        <div class="shangpin_left">\n' +
                                '                            <div class="left" id="delivery_8525_0"><a href="#shipmentAnchor_8525_0" name="shipmentAnchor_8525_0" id="shipmentAnchor_8525_0"></a>\n' +
                                '                                <p class="method_tip red" style="color:black;text-align: left">\n' +
                                '                                    <span class="icon_tip_s" style="display:none;"></span>请选择配送方式\n' +
                                '                                </p>\n' +
                                '                                <div id="divDeliveryMethod_8525_0">\n' +
                                '                                    <ul class="method">\n' +
                                '                                        <li>\n' +
                                '                                            <a id="methed_id_1" class="current" href="javascript:void(0);">普通快递</a>\n' +
                                '                                        </li>\n' +
                                '                                    </ul>\n' +
                                '                                </div>\n' +
                                '                            </div>\n' +
                                '                        </div>\n' +
                                '                        <div class="shangpin_right">\n' +
                                '                            <div class="subpackage_title">\n' +
                                '                                以下商品 单独配送\n' +
                                '                                <span class="charge">运费:'+goodsMsg.yufei.toFixed(2)+'</span>\n' +
                                '                            </div>\n' +
                                '                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
                                '                                <tbody>\n' +
                                '                                <tr>\n' +
                                '                                    <th scope="col" class="th_img">&nbsp;</th>\n' +
                                '                                    <th scope="col" class="th_name">商品名称</th>\n' +
                                '                                    <th scope="col">单价</th>\n' +
                                '                                    <th scope="col">数量</th>\n' +
                                '                                    <th scope="col">总价</th>\n' +
                                '                                </tr>\n' +
                                '                                <!-- 普通商品 -->\n' +
                                '                                </tbody>\n' +
                                '                            </table>\n' +
                                '                            <div class="promo_title">商品已为您打包好，欢迎下次继续光顾！！</div>\n' +
                                '                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
                                '                                <tbody>\n' +
                                '                                <tr id="1517542454_NOTGIFT" ddt-data-key="productid" ddt-data="1517542454">\n' +
                                '                                    <td class="img">\n' +
                                '                                        <a href="/goods_detail.html?goodsID='+goodsMsg.goods.goodsID+'&&item='+goodsMsg.goods.item+'"><img src="'+goodsMsg.goods.imgsrc+'" height="70" width="70"></a>\n' +
                                '                                    </td>\n' +
                                '                                    <td class="name">\n' +
                                '                                        <a href="/goods_detail.html?goodsID='+goodsMsg.goods.goodsID+'&&item='+goodsMsg.goods.item+'"  target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">'+goodsMsg.goods.description+'</a>\n' +
                                '                                        <p class="seven">\n' +
                                '                                            <span class="icon_7"></span>支持7天无理由退换货\n' +
                                '                                        </p>\n' +
                                '                                    </td>\n' +
                                '                                    <td>'+goodsMsg.goods.price.toFixed(2)+'</td>\n' +
                                '                                    <td>'+goodsMsg.goodsNum+'</td>\n' +
                                '                                    <td>'+(goodsMsg.goodsNum*goodsMsg.goods.price).toFixed(2)+'</td>\n' +
                                '                                </tr>\n' +
                                '                                </tbody>\n' +
                                '                            </table>\n' +
                                '                            <div class="promo_total"><em>促销优惠：0.00</em><em>小计：'+(goodsMsg.goodsNum*goodsMsg.goods.price).toFixed(2)+'</em></div>\n' +
                                '                        </div>\n' +
                                '                    </div>\n' +
                                '                    <div class="sub">\n' +
                                '                        <div class="sub_left">\n' +
                                '                            <p>给商家留言<textarea id="text_shop_message_8525_0" name="" cols="" rows="2" maxlength="70"></textarea>\n' +
                                '                                <span class="txt_n" id="shop_message_length_8525_0">0/70</span>\n' +
                                '                            </p>\n' +
                                '                        </div>\n' +
                                '                        <div class="sub_right">\n' +
                                '                            <p>\n' +
                                '                                <span class="red" id="goodsNum'+i+'">'+goodsMsg.goodsNum+'</span>个包裹\n' +
                                '                                <span class="tab" id="goodsPrice'+i+'">商品金额：'+(goodsMsg.goodsNum*goodsMsg.goods.price).toFixed(2)+'</span>\n' +
                                '                                <span class="tab" id="yufei'+i+'">运费：'+goodsMsg.yufei.toFixed(2)+'</span>\n' +
                                '                                <span class="tab">促销优惠：\n' +
                                '                                    <span class="price" id="cuxiao'+i+'">-0.00</span>\n' +
                                '\t\t\t\t                </span>\n' +
                                '                            </p>\n' +
                                '                            <p>\n' +
                                '                                <span class="tab">店铺合计：</span>\n' +
                                '                                <span class="price red">'+(goodsMsg.goodsNum*goodsMsg.goods.price+goodsMsg.yufei).toFixed(2)+'</span>\n' +
                                '                            </p>\n' +
                                '                        </div>\n' +
                                '                    </div>\n' +
                                '                </div>\n' +
                                '            </div>'
                            $("#shipment").append(orderGoods)
                        }
                    }
                    var goodsTotalPrice=0;
                    var yufeiTotal=0;
                    var cuxiaoTotal=0;
                    var goodsTotalNum=0;
                    for (var i = 0; i < data.data.items.length; i++) {
                        /*商品总价格*/
                        var goodsPriceLength=$("#goodsPrice"+i).html().length;
                        var goodsPrice=$("#goodsPrice"+i).html().substring(5,goodsPriceLength);
                        goodsTotalPrice=goodsTotalPrice+parseFloat(goodsPrice);
                        /*商品总运费*/
                        var yufeiLength=$("#yufei"+i).html().length;
                        var yufei=$("#yufei"+i).html().substring(3,yufeiLength)
                        yufeiTotal=yufeiTotal+parseFloat(yufei)
                        /*商品总优惠*/
                        var cuxiaoLength=$("#cuxiao"+i).html().length;
                        var cuxiao=$("#cuxiao"+i).html().substring(1,cuxiaoLength)
                        cuxiaoTotal=cuxiaoTotal+parseFloat(cuxiao)
                        /*包裹总数量*/
                        var goodsNum=$("#goodsNum"+i).text();
                        goodsTotalNum=goodsTotalNum+parseInt(goodsNum);
                    }
                    $("#goodsPriceTotal").html("&nbsp;"+goodsTotalPrice.toFixed(2))
                    $("#yufeiTotal").html("&nbsp;&nbsp;"+yufeiTotal.toFixed(2))
                    $("#cuxiaoTotal").html("-"+cuxiaoTotal.toFixed(2))
                    $("#payTotalPrice").html((goodsTotalPrice+yufeiTotal-cuxiaoTotal).toFixed(2))
                    $("#goodsNumTotal").html(goodsTotalNum)
                    $("#payTotalPrice1").html((goodsTotalPrice+yufeiTotal-cuxiaoTotal).toFixed(2))
                    $("#yufeiTotal1").html("&nbsp;&nbsp;"+yufeiTotal.toFixed(2))
                }else{
                    $("#cart_screenhead").remove();
                    $("#shop_content").html("")
                    var kongCart='<div class="empty" id="empty" style="">\n' +
                        '            <div class="empty_content">\n' +
                        '                <div>您没有该类型的订单，回首页<a href="/index.html">去逛逛~~</a></div>\n' +
                        '            </div>\n' +
                        '        </div>'
                    $("#shop_content").append(kongCart);
                    $("#footer").remove();
                }
            })
        })
    </script>
</head>
<body>
<!--引入头部-->
<div id="header"></div>
<div class="cart_screen">
    <div class="cart_screenhead" id="cart_screenhead">
        <span><a href="/shop_cart.html">我的购物车</a></span>
        <span class="current">填写订单</span>
        <span>完成订单</span>
    </div>
    <div class="shop_content" id="shop_content">
        <!--收货人信息-->
        <div id="myaddress" class="myaddress">
            <h1 class="title">收货人信息</h1>
            <div class="addr_list" id="address_content">
                <ul id="receivemsg">
                    <!--<li class="addr active"  address_index="0" address_id="305735500" address_status="2">
                        <h1 id="memberName">张真
                            <span id="memberPhone">185****4847</span>
                        </h1>
                        <p id="memberAddress1">中国 湖南 长沙市 岳麓区 </p>
                        <p id="memberAddress2" style="width: 200px;text-align: left">****湖南财政经济学院</p>
                        <span id="oper_305735500">
                            <a href="javascript:void(0)" name="oper">编辑</a>
                            <a href="javascript:void(0)" name="oper" style="display: none;">删除 </a>
                            <a href="javascript:void(0)" class="us" name="oper">设为默认地址</a>
                        </span>
                    </li>-->
                    <!--<li class="addr active" id="address_block_305735500" address_index="0" address_id="305735500" address_status="2">
                        <h1 id="memberName">张真
                            <span id="memberPhone">185****4847</span>
                        </h1>
                        <p id="memberAddress1">中国 湖南 长沙市 岳麓区 </p>
                        <p id="memberAddress2" style="width: 200px;text-align: left">****湖南财政经济学院</p>
                        <span id="oper_305735500">
                            <a href="javascript:void(0)" name="oper">编辑</a>
                            <a href="javascript:void(0)" name="oper" style="display: none;">删除 </a>
                            <a href="javascript:void(0)" class="us" name="oper">设为默认地址</a>
                        </span>
                    </li>-->
                </ul>
                <p>
                    <a href="javascript:void(0)" class="btn_address" id="btn_show_more_address" style="display: none;">展开地址<b class="bicon a_d"> +</b></a>
                    <button class="btn_address" data-toggle="modal" data-target="#addProduct">新增收货地址<b class="bicon"> +</b></button>
                </p>
            </div>
        </div>
        <!--商品清单-->
        <div id="shipment" class="w960">
            <h1 class="title">
                <a href="http://shopping.dangdang.com/shoppingcart/shopping_cart.aspx" class="fr modify">返回购物车</a>
                商品清单
            </h1>
            <!--<div class="shipping" id="shipping">
                <div class="title">森马官方旗舰店</div>
                <div class="ship_box">
                    <div class="shangpin">
                        <div class="shangpin_left">
                            <div class="left" id="delivery_8525_0"><a href="#shipmentAnchor_8525_0" name="shipmentAnchor_8525_0" id="shipmentAnchor_8525_0"></a>
                                <p class="method_tip red" style="color:black;text-align: left">
                                    <span class="icon_tip_s" style="display:none;"></span>请选择配送方式
                                </p>
                                <div id="divDeliveryMethod_8525_0">
                                    <ul class="method">
                                        <li>
                                            <a id="methed_id_1" class="current" href="javascript:void(0);">普通快递</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="shangpin_right">
                            <div class="subpackage_title">
                                以下商品 单独配送
                                <span class="charge">运费:12.00</span>
                            </div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr>
                                    <th scope="col" class="th_img">&nbsp;</th>
                                    <th scope="col" class="th_name">商品名称</th>
                                    <th scope="col">单价</th>
                                    <th scope="col">数量</th>
                                    <th scope="col">总价</th>
                                </tr>
                                &lt;!&ndash; 普通商品 &ndash;&gt;
                                </tbody>
                            </table>
                            <div class="promo_title">以下商品参加森马大牌日</div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr id="1517542454_NOTGIFT" ddt-data-key="productid" ddt-data="1517542454">
                                    <td class="img">
                                        <img src="//img3m4.ddimg.cn/65/34/1517542454-1_t_1.jpg" height="70" width="70">
                                    </td>
                                    <td class="name">
                                        <a href="http://product.dangdang.com/1517542454.html" title="【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫衣男新款黑色连帽套头衫上衣潮牌宽松字母印花外套冬季_铁灰2660,XXL" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫...</a>
                                        <p class="seven">
                                            <span class="icon_7"></span>支持7天无理由退换货
                                        </p>
                                    </td>
                                    <td>259.00</td>
                                    <td>1</td>
                                    <td>259.00</td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="promo_total"><em>促销优惠：-181.30</em><em>小计：77.70</em></div>
                        </div>
                    </div>
                    <div class="sub">
                        <div class="sub_left">
                            <p>给商家留言<textarea id="text_shop_message_8525_0" name="" cols="" rows="2" maxlength="70"></textarea>
                                <span class="txt_n" id="shop_message_length_8525_0">0/70</span>
                            </p>
                        </div>
                        <div class="sub_right">
                            <p>
                                <span class="red">1</span>个包裹
                                <span class="tab">商品金额：259.00</span>
                                <span class="tab">运费：12.00</span>
                                <span class="tab">促销优惠：
                                    <span class="price">-181.30</span>
				                </span>
                            </p>
                            <p>
                                <span class="tab">店铺合计：</span>
                                <span class="price red">89.70</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>-->
            <!--<div class="shipping">
                <div class="title">森马官方旗舰店</div>
                <div class="ship_box">
                    <div class="shangpin">
                        <div class="shangpin_left">
                            <div class="left" id="delivery_8525_0"><a href="#shipmentAnchor_8525_0" name="shipmentAnchor_8525_0" id="shipmentAnchor_8525_0"></a>
                                <p class="method_tip red" style="color:black;text-align: left">
                                    <span class="icon_tip_s" style="display:none;"></span>请选择配送方式
                                </p>
                                <div id="divDeliveryMethod_8525_0">
                                    <ul class="method">
                                        <li>
                                            <a id="methed_id_1" class="current" href="javascript:void(0);">普通快递</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="shangpin_right">
                            <div class="subpackage_title">
                                以下商品 单独配送
                                <span class="charge">运费:12.00</span>
                            </div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr>
                                    <th scope="col" class="th_img">&nbsp;</th>
                                    <th scope="col" class="th_name">商品名称</th>
                                    <th scope="col">单价</th>
                                    <th scope="col">数量</th>
                                    <th scope="col">总价</th>
                                </tr>
                                &lt;!&ndash; 普通商品 &ndash;&gt;
                                </tbody>
                            </table>
                            <div class="promo_title">以下商品参加森马大牌日</div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr id="1517542454_NOTGIFT" ddt-data-key="productid" ddt-data="1517542454">
                                    <td class="img">
                                        <img src="//img3m4.ddimg.cn/65/34/1517542454-1_t_1.jpg" height="70" width="70">
                                    </td>
                                    <td class="name">
                                        <a href="http://product.dangdang.com/1517542454.html" title="【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫衣男新款黑色连帽套头衫上衣潮牌宽松字母印花外套冬季_铁灰2660,XXL" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫...</a>
                                        <p class="seven">
                                            <span class="icon_7"></span>支持7天无理由退换货
                                        </p>
                                    </td>
                                    <td>259.00</td>
                                    <td>1</td>
                                    <td>259.00</td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="promo_total"><em>促销优惠：-181.30</em><em>小计：77.70</em></div>
                        </div>
                    </div>
                    <div class="sub">
                        <div class="sub_left">
                            <p>给商家留言<textarea id="text_shop_message_8525_0" name="" cols="" rows="2" maxlength="70"></textarea>
                                <span class="txt_n" id="shop_message_length_8525_0">0/70</span>
                            </p>
                        </div>
                        <div class="sub_right">
                            <p>
                                <span class="red">1</span>个包裹
                                <span class="tab">商品金额：259.00</span>
                                <span class="tab">运费：12.00</span>
                                <span class="tab">促销优惠：
                                    <span class="price">-181.30</span>
				                </span>
                            </p>
                            <p>
                                <span class="tab">店铺合计：</span>
                                <span class="price red">89.70</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="shipping">
                <div class="title">森马官方旗舰店</div>
                <div class="ship_box">
                    <div class="shangpin">
                        <div class="shangpin_left">
                            <div class="left" id="delivery_8525_0"><a href="#shipmentAnchor_8525_0" name="shipmentAnchor_8525_0" id="shipmentAnchor_8525_0"></a>
                                <p class="method_tip red" style="color:black;text-align: left">
                                    <span class="icon_tip_s" style="display:none;"></span>请选择配送方式
                                </p>
                                <div id="divDeliveryMethod_8525_0">
                                    <ul class="method">
                                        <li>
                                            <a id="methed_id_1" class="current" href="javascript:void(0);">普通快递</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="shangpin_right">
                            <div class="subpackage_title">
                                以下商品 单独配送
                                <span class="charge">运费:12.00</span>
                            </div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr>
                                    <th scope="col" class="th_img">&nbsp;</th>
                                    <th scope="col" class="th_name">商品名称</th>
                                    <th scope="col">单价</th>
                                    <th scope="col">数量</th>
                                    <th scope="col">总价</th>
                                </tr>
                                &lt;!&ndash; 普通商品 &ndash;&gt;
                                </tbody>
                            </table>
                            <div class="promo_title">以下商品参加森马大牌日</div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr id="1517542454_NOTGIFT" ddt-data-key="productid" ddt-data="1517542454">
                                    <td class="img">
                                        <img src="//img3m4.ddimg.cn/65/34/1517542454-1_t_1.jpg" height="70" width="70">
                                    </td>
                                    <td class="name">
                                        <a href="http://product.dangdang.com/1517542454.html" title="【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫衣男新款黑色连帽套头衫上衣潮牌宽松字母印花外套冬季_铁灰2660,XXL" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫...</a>
                                        <p class="seven">
                                            <span class="icon_7"></span>支持7天无理由退换货
                                        </p>
                                    </td>
                                    <td>259.00</td>
                                    <td>1</td>
                                    <td>259.00</td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="promo_total"><em>促销优惠：-181.30</em><em>小计：77.70</em></div>
                        </div>
                    </div>
                    <div class="sub">
                        <div class="sub_left">
                            <p>给商家留言<textarea id="text_shop_message_8525_0" name="" cols="" rows="2" maxlength="70"></textarea>
                                <span class="txt_n" id="shop_message_length_8525_0">0/70</span>
                            </p>
                        </div>
                        <div class="sub_right">
                            <p>
                                <span class="red">1</span>个包裹
                                <span class="tab">商品金额：259.00</span>
                                <span class="tab">运费：12.00</span>
                                <span class="tab">促销优惠：
                                    <span class="price">-181.30</span>
				                </span>
                            </p>
                            <p>
                                <span class="tab">店铺合计：</span>
                                <span class="price red">89.70</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="shipping">
                <div class="title">森马官方旗舰店</div>
                <div class="ship_box">
                    <div class="shangpin">
                        <div class="shangpin_left">
                            <div class="left" id="delivery_8525_0"><a href="#shipmentAnchor_8525_0" name="shipmentAnchor_8525_0" id="shipmentAnchor_8525_0"></a>
                                <p class="method_tip red" style="color:black;text-align: left">
                                    <span class="icon_tip_s" style="display:none;"></span>请选择配送方式
                                </p>
                                <div id="divDeliveryMethod_8525_0">
                                    <ul class="method">
                                        <li>
                                            <a id="methed_id_1" class="current" href="javascript:void(0);">普通快递</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="shangpin_right">
                            <div class="subpackage_title">
                                以下商品 单独配送
                                <span class="charge">运费:12.00</span>
                            </div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr>
                                    <th scope="col" class="th_img">&nbsp;</th>
                                    <th scope="col" class="th_name">商品名称</th>
                                    <th scope="col">单价</th>
                                    <th scope="col">数量</th>
                                    <th scope="col">总价</th>
                                </tr>
                                &lt;!&ndash; 普通商品 &ndash;&gt;
                                </tbody>
                            </table>
                            <div class="promo_title">以下商品参加森马大牌日</div>
                            <table class="list" border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tbody>
                                <tr id="1517542454_NOTGIFT" ddt-data-key="productid" ddt-data="1517542454">
                                    <td class="img">
                                        <img src="//img3m4.ddimg.cn/65/34/1517542454-1_t_1.jpg" height="70" width="70">
                                    </td>
                                    <td class="name">
                                        <a href="http://product.dangdang.com/1517542454.html" title="【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫衣男新款黑色连帽套头衫上衣潮牌宽松字母印花外套冬季_铁灰2660,XXL" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">【2.7折价：69.93元，领券低至2.4折，4.16-4.18森马周年庆狂欢】森马卫...</a>
                                        <p class="seven">
                                            <span class="icon_7"></span>支持7天无理由退换货
                                        </p>
                                    </td>
                                    <td>259.00</td>
                                    <td>1</td>
                                    <td>259.00</td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="promo_total"><em>促销优惠：-181.30</em><em>小计：77.70</em></div>
                        </div>
                    </div>
                    <div class="sub">
                        <div class="sub_left">
                            <p>给商家留言<textarea id="text_shop_message_8525_0" name="" cols="" rows="2" maxlength="70"></textarea>
                                <span class="txt_n" id="shop_message_length_8525_0">0/70</span>
                            </p>
                        </div>
                        <div class="sub_right">
                            <p>
                                <span class="red">1</span>个包裹
                                <span class="tab">商品金额：259.00</span>
                                <span class="tab">运费：12.00</span>
                                <span class="tab">促销优惠：
                                    <span class="price">-181.30</span>
				                </span>
                            </p>
                            <p>
                                <span class="tab">店铺合计：</span>
                                <span class="price red">89.70</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>-->
        </div>
        <!--支付方式-->
        <div id="payment_div" class="w960">
            <h1 class="title">支付方式</h1>
            <div class="payment new_payment">
                <ul class="ul_list clearfix">
                    <li style="display: block" class="aa">
                        <a href="javascript:void(0)" class="btn_pay  current" id="payment_online">网上支付</a>
                    </li>
                    <li style="z-index:5;" class="aa">
                        <a id="payment_after_arrival" href="javascript:void(0)" class="btn_pay disabled ">货到付款<span></span>
                            <i id="paa_disabled" class="icon iconfont icon-tanhao-"></i>
                        </a>
                        <div id="ppa_div" class="drop_list" style="display:none">
                            <div class="tips">请选择货到付款方式</div>
                            <div class="list">
                                <ul>
                                    <li id="payment_in_cash_after_arrival" class="disabled">现金</li>
                                    <li id="payment_with_pos_after_arrival" class="disabled">POS刷卡</li>
                                    <li id="payment_with_alipay_after_arrival" class="disabled">支付宝扫码</li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="aa" style="display: block">
                        <a href="javascript:void(0)" class="btn_pay  disabled" id="payment_banking">银行转账</a>
                    </li>
                    <li class="aa" style="display: block">
                        <a href="javascript:void(0)" class="btn_pay disabled " id="payment_by_other">他人代付</a>
                    </li>
                </ul>
            </div>
        </div>
        <!--发票-->
        <div id="invoice_div" class="w960">
            <h1 class="title">发票</h1>
            <div class="invoice">
                <p>
                    <a id="invoiceCheck" href="javascript:void(0);" class="check"></a>需要开发票
                </p>
                <div id="VATInvoiceQuestionTips" class="pop" style="position:absolute;display:none;z-index:99999;background-color:#ffffff;width:136px;">
                    <div class="nomal_tips">您的订单中含有图书商品，根据《财税【2013】87号》文件，图书类商品不可开具增值税专用发票。</div>
                </div>
            </div>
        </div>
        <!--优惠券和余额-->
        <div id="noncash_div" class="w960">
            <div id="all_noncash" class="pay_list">
                <div id="coupons_div_new">
                    <div id="coupons_pay_detail_n" class="pay_title">
                        <a href="javascript:void(0)" class="op"></a>
                        <span class="title">礼券/运费券</span>
                    </div>
                    <div class="pay_detail">
                        <p>
                            本次结算没有可用礼券/运费券，您可以
                            <a href="http://newaccount.dangdang.com/payhistory/mycoupon.aspx" target="_blank" class="link">了解礼券/运费券使用规则</a>或者
                            <a href="javascript:void(0)" class="link" onclick="bindCoupon();">激活</a>
                        </p>
                    </div>

                </div>
                <div id="balance_div">
                    <div class="pay_title">
                        <a id="balance_button" href="javascript:void(0);" onclick="javascript:displayBalance();" class="op"></a>
                        <span class="title">余额</span><span id="balance_detail" style="display:none">（您的账户中没有可用余额）</span>
                    </div>
                </div>
            </div>
        </div>
        <!--总计-->
        <div id="summary_div">
            <div class="total">
                <div>
                    <div class="border">
                        <p><span class="name">商品金额：</span><span class="price" id="goodsPriceTotal">259.00</span></p>
                        <p><span class="name">运费：</span><span class="price" id="yufeiTotal">12.00</span></p>
                    </div>
                </div>
                <div>
                    <div class="border">
                        <p><span class="name">促销优惠：</span><span class="price" id="cuxiaoTotal">-181.30</span></p>
                    </div>
                </div>
                <div style="height: 50px">
                    <p class="total_price">
                        <span class="name">应付金额：</span>
                        <span class="price red" id="payTotalPrice">89.70</span>
                    </p>
                </div>
                <div class="confirm">
                    <p style="text-align: right">
                        <span class="big">寄送至：</span>
                        <span id="address_summary" style="font-size: 12px;">中国 湖南 长沙市 岳麓区  ****湖南财政经济学院</span>&nbsp;&nbsp;&nbsp;&nbsp;
                        <span id="name_phone_summary" style="font-size: 12px;">张真 185****4847</span>
                    </p>
                </div>
            </div>
        </div>
        <!--商品总价格和支付按钮-->
        <div id="submit_div_inner" class="submit">
            <!-- 受限-->
            <div id="max_vddmoney" class="alart_con" style="display:none">
                <span class="icon_tip"></span>根据国家法律规定，购买电子礼品卡不可超过10000元。
            </div>
            <div class="box tip_tuan">
                共<span class="red" id="goodsNumTotal">1</span>件商品
                <span class="price">应付金额：
                    <span class="red" id="payTotalPrice1">89.70</span>
                </span>
                (含运费<span class="red" id="yufeiTotal1">12.00</span>元)
                <a id="order_submit" href="javascript:void(0)" class="btn_red">去支付</a>
                <p>热销品订单请在 <strong>2小时</strong> 内完成支付</p>
            </div>
        </div>
    </div>
    <!--新增收货地址-->
    <div class="modal fade" id="addProduct" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">新增收货地址</h4>
                </div>
                <div class="modal-body">
                    <form id="addProduct_form" class="form-horizontal"
                          action="order/addReceiveMsg.do" method="post">
                        <div class="form-group">
                            <label for="receiveName" class="col-sm-2 control-label">收货人</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" id="receiveName" name="receiveName" placeholder="请输入收货人姓名">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="receivePhone" class="col-sm-2 control-label">手机号码</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" id="receivePhone" name="receivePhone" placeholder="请输入收货人手机号码">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="receiveAddress" class="col-sm-2 control-label">所在地区</label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control" id="receiveAddress" name="receiveAddress" placeholder="请输入收货点所在地区">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="receiveDetailAddress" class="col-sm-2 control-label">详细地址</label>
                            <div class="col-sm-5">
                                <input class="form-control" id="receiveDetailAddress" name="receiveDetailAddress" placeholder="请输入收货点所在的详细地址"></input>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="add">确认新增收货地址</button>
                </div>
            </div>
        </div>
    </div>
    <!--修改收货地址-->
    <div class="modal fade" id="updateProduct" tabindex="-1" role="dialog" aria-labelledby="updateexampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="updateexampleModalLabel">编辑收货地址</h4>
                </div>
                <div class="modal-body">
                    <form id="updateaddProduct_form" class="form-horizontal"
                          action="order/addReceiveMsg.do" method="post">
                        <div class="form-group">
                            <label for="updatereceiveName" class="col-sm-2 control-label">收货人</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" id="updatereceiveName" name="receiveName" placeholder="请输入收货人姓名">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="updatereceivePhone" class="col-sm-2 control-label">手机号码</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" id="updatereceivePhone" name="receivePhone" placeholder="请输入收货人手机号码">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="updatereceiveAddress" class="col-sm-2 control-label">所在地区</label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control" id="updatereceiveAddress" name="receiveAddress" placeholder="请输入收货点所在地区">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="updatereceiveDetailAddress" class="col-sm-2 control-label">详细地址</label>
                            <div class="col-sm-5">
                                <input class="form-control" id="updatereceiveDetailAddress" name="receiveDetailAddress" placeholder="请输入收货点所在的详细地址"></input>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="update">确认修改收货地址</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="footer"></div>
</body>
</html>